%%% foregrounds.tex ---

\documentclass[twoside,10pt]{article}

% \usepackage{epsfig}
\usepackage{color}
\usepackage{fancyhdr}
\usepackage{rotating}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{nicefrac}
\usepackage{cool}
\usepackage{mathrsfs}
\usepackage{units}
\usepackage{amsmath}
\usepackage{subfig}
\usepackage{hyperref}
\Style{DSymb={\mathrm d},IntegrateDifferentialDSymb=\text{d}}

% define formatting
% A4 paper is 210 x 297 mm
% pt  point         (1 in = 72.27 pt)
% pc  pica          (1 pc = 12 pt)
% in  inch          (1 in = 25.4 mm)
% bp  big point     (1 in = 72 bp)
% cm  centimetre    (1 cm = 10 mm)
% mm  millimetre
% dd  didot point   (1157 dd = 1238 pt)
% cc  cicero        (1 cc = 12 dd)
% sp  scaled point  (65536 sp = 1 pt)
% em  the width of the letter M in the current font
% ex  the height of the letter x in the current font

\setlength{\textheight}{11.in}
\setlength{\textwidth}{8.5in}

\setlength{\topmargin}{0.in}
\setlength{\headheight}{\baselineskip}
\setlength{\headsep}{2\baselineskip}

\addtolength{\textheight}{-\headheight}
\addtolength{\textheight}{-\headsep}
\addtolength{\textheight}{-2.in}
\addtolength{\textwidth}{-2.in}


\setlength{\oddsidemargin}{0.in}
\setlength{\evensidemargin}{0.in}

\setlength{\parindent}{0.em}
\setlength{\parskip}{0.75\baselineskip}

\def\boxwidth{\textwidth}
\def\doctitle{Foreground Modeling and Estimation}         % Document title defined here
\def\myname{Justin Lazear}      % Primary author defined here
\def\myemail{\texttt{jlazear@pha.jhu.edu}} % Primary author email
\def\piper{\textsc{Piper}}
\def\tablefont{\footnotesize}

% \renewcommand{\thefootnote}{\fnsymbol{footnote}}

%% \pagestyle{fancy}
%% \fancyhead{}
%% \fancyhead[LE,RO]{{\it {\large \thepage}}}
%% \fancyhead[RE]{{\it {\large \myname{}}}}
%% \fancyhead[LO]{{\it {\large \doctitle{}}}}
%% \fancyfoot{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define some math macros for convenience

% Note that most necessarily math macros are defined by the cool
% package, so this section is sparse.

\DeclareMathOperator{\Uniform}{\mathcal{U}}

\newcommand{\ve}[1]{\mathbf{#1}}
\newcommand{\Avg}[1]{\left< #1 \right>}
\newcommand{\abs}[1]{\lvert#1\rvert}
\newcommand{\pp}[1]{\left( #1 \right)}
\newcommand{\pb}[1]{\left[ #1 \right]}
\newcommand{\pc}[1]{\left\{ #1 \right\} }
\newcommand{\dd}[0]{\mathrm{d}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{\doctitle}
\author{\myname}
\date{Jan 20, 2015}

\begin{document}
\maketitle

\section{Introduction}
\label{sec:intro}

Let us construct a very simple foreground as a toy example for use in our
explorations. Since we are working only on simulated data and we are more
interested in the general properties of our methods rather than the precise
details of the results, a toy model is sufficient.

\section{Thermal Dust Foreground} % (fold)
\label{sec:thermal_dust_foreground}

At high frequencies and large angular scales, dust dominates the foreground
(Fig.~\ref{fig:foregrounds_vs_frequency}) in intensity. With this in mind, we
will begin by constructing a foreground map that comprises only dust.

\begin{figure}[ht]
    \begin{center}
        \includegraphics[width=0.8\textwidth]{img/cb9_f22_M.png}
    \end{center}
    \caption{Frequency spectra of CMB temperature anisotropies and
    foregrounds. Above 80 GHz, the thermal dust is the dominant contributor.
    From Bennett et al 2009 \cite{bennett_nine-year_2013}.}
    \label{fig:foregrounds_vs_frequency}
\end{figure}

Let us model the thermal dust emission as a power law,

\begin{equation}
    \label{eq:dust_power_law}
    I_\nu(p) = I_{\nu_0}(p) \left( \frac{\nu}{\nu_0} \right)^\beta
\end{equation}

where $I_\nu$ is the spectral intensity in MJy/sr, $I_{\nu_0}$ is some
reference amplitude map at the reference frequency $\nu_0$, and $\beta$ is the
spectral index. So given a map $I_{\nu_0}(p)$ at frequency $\nu_0$, we may
construct a map of the thermal dust emission at an arbitrary frequency by
scaling it by $\left( \frac{\nu}{\nu_0} \right)^\beta$. We ignore more
sophisticated models that involve modeling the dust as particles at a
particular temperature with a particular emissivity.

Let us use the Planck thermal dust component map\footnote{This map is produced
by the Planck team by using a parameterized CMB + Foreground model and an MCMC
solver to minimize the $\chi^2$ of the model given the data, the \texttt
{Commaner-Ruler} algorithm. The map generated by only one component of the
model, using the optimal parameters, is the component map. In particular, we
use only the intensity (I) component of the $N_\mathrm{side} = 256$ map.

The map is available from the
\href{http://pla.esac.esa.int/pla/index.html}{Planck Legacy Archive} under
Maps $\rightarrow$ Foreground maps $\rightarrow$ Dust $\rightarrow$
\texttt{COM\_CompMap\_dust-commrul\_0256\_R1.00.fits}.}\cite{planck_collaboration_planck_2014} at 353 GHz
as our reference map (Fig.~\ref{fig:planck_dust_353}). We may then construct a
thermal dust emission foreground map at an arbitrary frequency by scaling the
reference map using Eq.~\eqref{eq:dust_power_law} with
$\nu_0 = \unit[353]{GHz}$.

\begin{figure}[th]
    \begin{center}
        \includegraphics[width=0.8\textwidth]{img/planck_dust_353GHz}
    \end{center}
    \caption{Planck thermal dust emission component map (from
    \texttt{Commander-Ruler} algorithm) at 353 GHz. From
    \texttt{COM\_CompMap\_dust-commrul\_0256\_R1.00.fits} intensity field.
    Histogram is equalized. Pixels that had a negative value in the original
    map have had their value replaced with 0.}
    \label{fig:planck_dust_353}
\end{figure}

Some pixels in the Planck dust emission map have a negative intensity. These
can potentially cause problems and are not physically realizable, so we
replace the value of such pixels with 0.

We note that our power law is not in thermodynamic temperature units, but is
rather in MJy/sr. This is incompatible with our sky maps, which are typically
in thermodynamic temperature units (K). The conversion between spectral
intensity $I_\nu$ and thermodynamic temperature $T$ is
\begin{gather}
    I_\nu = B_\nu(T) = \frac{2h\nu^3}{c^2} \frac{1}{\exp{\left( h\nu/k_B T \right)} - 1} \\
    T = B_\nu^{-1}(I_\nu) = \frac{h\nu}{k_B} \frac{1}{\log{(1 + \frac{2h\nu^3}{I_\nu c^2})}}
\end{gather}

so our power law (Eq.~\eqref{eq:dust_power_law}) gives us the transformation
\begin{align}
    T & = B_\nu^{-1} \left( I_{\nu_0} \left( \frac{\nu}{\nu_0} \right)^\beta \right) \notag \\
    T & = \frac{h\nu}{k_B} \frac{1}{\log{(1 + \frac{2 h \nu^{3-\beta}}{c^2 \nu_0^{-\beta}} \frac{1}{I_{\nu_0}})}} \\
    T & = \frac{h\nu}{k_B} \frac{1}{\log{\pb{ 1 + \pp{\frac{\nu}{\nu_0}}^{3-\beta} \pp{\exp \frac{h\nu_0}{k_B T_0} - 1} }}}
\end{align}

\section{Polarized Dust Intensity}
\label{sec:polarized_dust_intensity}

As a simple estimate of the polarized dust intensity, let us suppose that
there is a constant polarization fraction of the thermal dust intensity,

\begin{equation}
    p = \frac{I_p}{I} = \frac{\sqrt{Q^2 + U^2 + V^2}}{I}
\end{equation}

where $I_p$ is the polarized intensity, $Q$, $U$, and $V$ are the polarized
components of the Stokes vector, and $I$ is the total intensity. Planck
estimates that maximum polarization fraction is
$p_\mathrm{max} = 20\%$\cite{planck_collaboration_planck_2014-1}, so we will
use that as a pessimistic limit across the whole sky. In reality, we expect
the polarization fraction to be smaller than this, especially in the galactic
plane, where Planck reports the polarization fraction to typically be closer
to 5\%.

We may then construct a polarized intensity map

\begin{equation}
    I_p(p) = p_\mathrm{max} I_\nu(p)
\end{equation}

where $p$ here is the pixel index and $p_\mathrm{max} = 20\%$ is the maximum
polarization fraction. Note that this procedure should be done in spectral
intensity units rather than thermodynamic temperature units, since the
conversion is nonlinear,
$B_\nu^{-1}(p_\mathrm{max}I_\nu) \neq p_\mathrm{max} B_\nu^{-1}(I_\nu)$.

\begin{figure}[th]
    \begin{center}
        \includegraphics[width=0.8\textwidth]{img/pol_dust_353GHz}
    \end{center}
    \caption{Naive polarized dust intensity $I_p = pI$. Uses a constant
    polarization fraction $p = p_\mathrm{max} = 0.2$ to construct a map from
    the thermal dust intensity map.}
    \label{fig:pol_dust_353}
\end{figure}


\section{Polarized Dust Components}
\label{sec:polarized_dust_components}

The polarized dust intensity map does not contain all of the information
about the polarized radiation. We note from the definition of $I_p$,

\begin{equation}
    I_p = \sqrt{Q^2 + U^2 + V^2}
\end{equation}

that at each frequency and in each pixel, we must specify 3 numbers $Q$, $U$,
and $V$ (equivalently, the E-field vector components in some coordinate
system, $E_x$ and $E_y$, and the phase between the E-field components,
$\phi \equiv \theta_x - \theta_y$)\cite{kamionkowski_statistics_1997}
to fully specify the polarized light.

We assume that the circularly polarized component $V$ is
small\cite{mainini_improved_2013}, so we will set it to 0 and ignore it. This
leaves us 2 numbers that we need to specify. Since we do not know the true
values, we will randomly select a combination of $Q$ and $U$ that agrees with
the polarized intensity map. Then an ensemble of such realizations will
describe all possible $Q$ and $U$ maps that combine to construct the
particular $I_p$ map. If there is no physical phenomenon that would bias the
true $Q$ and $U$ maps, then we can assume that our particular sky is one such
realization of our ensemble and that the properties of the ensemble will
estimate the properties of the true phenomena.

We must generate an unbiased ensemble by sampling $Q$ and $U$ in a symmetric
way. We note that we have 2 unknowns ($Q$ and $U$) and 1 constraint equation,
so we must sample 1 random number to fully specify each realization. A simple
uniform sampling of either $Q$ or $U$ does not uniformly sample the space of
possible $\pc{Q, U}$ values. $Q$ and $U$ describe a circle with radius $I_p$,
so the space of possible choices of $Q$ and $U$ is a circle, which has only a
single free parameter, the angle $\theta$. In radial coordinates,

\begin{equation}
    Q + iU = I_p e^{i\theta}.
\end{equation}

Since $\abs{\dd\theta}$ is invariant under reflection
($\theta \to -\theta$) and translation ($\theta \to \theta + \theta_0$), a
uniform sampling of $\theta$ will uniformly sample the $\pc{Q, U}$ space.

Let $\Theta \sim \Uniform{(0, 2\pi)}$ be a uniformly distributed random
variable over the range 0 to $2\pi$. Then a number $\theta$ drawn from
$\Theta$ can be used to construct $Q$ and $U$ from $I_p$ for each pixel $p$,

\begin{equation}
    \text{for } \theta(p) \in \Theta \sim \Uniform{(0, 2\pi)}, \quad
    \begin{array}{l}
        Q(p) = I_p \cos{\theta(p)} = p_\mathrm{max} I_\nu \cos{\theta(p)}\\
        U(p) = I_p \sin{\theta(p)} = p_\mathrm{max} I_\nu \sin{\theta(p)}
    \end{array}
\end{equation}

for $p = 1, \dots, N_\mathrm{pix}$. One such realization of $Q$ and $U$ maps
is shown in Fig.~\ref{fig:QU}.

\begin{figure}[th]
    \begin{center}
        \includegraphics[width=0.8\textwidth]{img/Q}
        \includegraphics[width=0.8\textwidth]{img/U}
    \end{center}
    \caption{\emph{Top}: One realization of a $Q$ map in which each pixel has
    an independent angle $\theta$ that is uniformly sampled from 0 to $2\pi$,
    and $Q(p) = I_p \cos{\theta(p)}$. \emph{Bottom}: A $U$ map that matches
    the above $Q$ map.}
    \label{fig:QU}
\end{figure}

\bibliography{foregrounds}
\bibliographystyle{plain}


\end{document}